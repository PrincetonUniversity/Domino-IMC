---
title: "Zoom 06/05 - QoE Comparison"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
params:
  g4_static_experiment_name: "zoom-0605-4g-static"
  g4_mobile_experiment_name: "zoom-0605-4g-mobile"
  tc_static_experiment_name: "zoom-0605-tc-static"
  tc_mobile_experiment_name: "zoom-0605-tc-mobile"
  fig_path: fig/
---

```{R setup, include=FALSE}
source("../r/setup.R")

config <- list(
  "files" = list(
    "g4_static" = list(
      "ssim_file" = paste(params$g4_static_experiment_name, paste(params$g4_static_experiment_name, "ssim.csv", sep = "-"), sep = "/"),
      "core_frames_file" = paste(params$g4_static_experiment_name, paste(params$g4_static_experiment_name, "core-frames.csv", sep = "-"), sep = "/")
    ),
    "g4_mobile" = list(
      "ssim_file" = paste(params$g4_mobile_experiment_name, paste(params$g4_mobile_experiment_name, "ssim.csv", sep = "-"), sep = "/"),
      "core_frames_file" = paste(params$g4_mobile_experiment_name, paste(params$g4_mobile_experiment_name, "core-frames.csv", sep = "-"), sep = "/")
    ),
    "tc_static" = list(
      "ssim_file" = paste(params$tc_static_experiment_name, paste(params$tc_static_experiment_name, "ssim.csv", sep = "-"), sep = "/"),
      "receiver_frames_file" = paste(params$tc_static_experiment_name, paste(params$tc_static_experiment_name, "receiver-frames.csv", sep = "-"), sep = "/")
    ),
    "tc_mobile" = list(
      "ssim_file" = paste(params$tc_mobile_experiment_name, paste(params$tc_mobile_experiment_name, "ssim.csv", sep = "-"), sep = "/"),
      "receiver_frames_file" = paste(params$tc_mobile_experiment_name, paste(params$tc_mobile_experiment_name, "receiver-frames.csv", sep = "-"), sep = "/")
    )
  ),
  "single_color"      = "dodgerblue4"
)
```


```{r import}
ssim <- list(
  "g4_static" = read_csv(config$files$g4_static$ssim_file, col_types="iiin", comment="#"),
  "g4_mobile" = read_csv(config$files$g4_mobile$ssim_file, col_types="iiin", comment="#"),
  "tc_static" = read_csv(config$files$tc_static$ssim_file, col_types="iiin", comment="#"),
  "tc_mobile" = read_csv(config$files$tc_mobile$ssim_file, col_types="iiin", comment="#")
)

core_receiver_frames <- list(
  "g4_static" = read_csv(config$files$g4_static$core_frames_file, col_types = "nciciiffnnnnniiiin"),
  "g4_mobile" = read_csv(config$files$g4_mobile$core_frames_file, col_types = "nciciiffnnnnniiiin"),
  "tc_static" = read_csv(config$files$tc_static$receiver_frames_file, col_types = "nciciiffnnnnniiiin"),
  "tc_mobile" = read_csv(config$files$tc_mobile$receiver_frames_file, col_types = "nciciiffnnnnniiiin")
)


```

```{r ssim-cdf, fig.height = 4, fig.width = 6}

bind_rows(
  ssim$g4_static %>% select(ssim) %>%
    mutate(ssim = if_else(ssim == -1.0, NA, ssim), type = "4g_static") %>% filter(!is.na(ssim)),
  ssim$g4_mobile %>% select(ssim) %>%
    mutate(ssim = if_else(ssim == -1.0, NA, ssim), type = "4g_mobile") %>% filter(!is.na(ssim)),
  ssim$tc_static %>% select(ssim) %>%
    mutate(ssim = if_else(ssim == -1.0, NA, ssim), type = "tc_static") %>% filter(!is.na(ssim)),
  ssim$tc_mobile %>% select(ssim) %>%
    mutate(ssim = if_else(ssim == -1.0, NA, ssim), type = "tc_mobile") %>% filter(!is.na(ssim))
) %>% 
  ggplot(aes(x = ssim, color = type)) +
    labs(x = "SSIM", y = "CDF") +
    scale_color_brewer(
      name = "Experiment",
      palette = "Set1",
      breaks = c("4g_static", "4g_mobile", "tc_static", "tc_mobile"),
      labels = c("4G/static", "4G/mobile", "TC/static", "TC/mobile")) +
    stat_ecdf() +
    xlim(0.8,0.9) +
    theme_om() +
    theme(
      legend.position.inside = c(0.975,0.2)
    )
```

```{r fps-cdf, fig.height = 4, fig.width = 6}

bind_rows(
  core_receiver_frames$g4_static %>% mutate(type = "4g_static"),
  core_receiver_frames$g4_mobile %>% mutate(type = "4g_mobile"),
  core_receiver_frames$tc_static %>% mutate(type = "tc_static") ,
  core_receiver_frames$tc_mobile %>% mutate(type = "tc_mobile")
) %>% filter(media_type == 16) %>% select(type, fps) %>%
  ggplot(aes(x = fps, color = type)) +
    labs(x = "Frame Rate [fps]", y = "CDF") +
    scale_color_brewer(
      name = "Experiment",
      palette = "Set1",
      breaks = c("4g_static", "4g_mobile", "tc_static", "tc_mobile"),
      labels = c("4G/static", "4G/mobile", "TC/static", "TC/mobile")) +
    stat_ecdf() +
    theme_om() +
    xlim(0,30) +
    theme(
      legend.position.inside = c(0.2,0.8)
    )
```

```{r jitter-cdf, fig.height = 4, fig.width = 6}

bind_rows(
  core_receiver_frames$g4_static %>% mutate(type = "4g_static"),
  core_receiver_frames$g4_mobile %>% mutate(type = "4g_mobile"),
  core_receiver_frames$tc_static %>% mutate(type = "tc_static") ,
  core_receiver_frames$tc_mobile %>% mutate(type = "tc_mobile")
) %>% filter(media_type == 16) %>% select(type, jitter_ms) %>%
  ggplot(aes(x = jitter_ms, color = type)) +
    labs(x = "Video Jitter [ms] (log.)", y = "CDF") +
    scale_color_brewer(
      name = "Experiment",
      palette = "Set1",
      breaks = c("4g_static", "4g_mobile", "tc_static", "tc_mobile"),
      labels = c("4G/static", "4G/mobile", "TC/static", "TC/mobile")) +
    scale_x_log10(expand = c(0.05, 0), limits = c(10,100), breaks = c(10, 100)) +
    annotation_logticks(sides = "b", mid = unit(0.15, "cm"), long = unit(0.2, "cm"), color = "gray30") +
    stat_ecdf() +
    theme_om() +
    # xlim(0,NA) +
    theme(
      legend.position.inside = c(0.2,0.8)
    )
```
